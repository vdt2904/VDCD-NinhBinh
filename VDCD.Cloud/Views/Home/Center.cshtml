@model VDCD.Models.CenterModelView
@{

    Layout = "~/Views/Shared/_Layout.cshtml";
}
@functions {
    // Hàm hỗ trợ lấy giá trị nhanh và an toàn
    string GetSt(string key) => Model.Settings.ContainsKey(key) ? Model.Settings[key] : "";
}
<script>
    $(document).ready(function () {
        $.ajax({
            url: '/home/GetHeader',
            type: 'GET',
            success: function (response) {
                if (response.success) {
                    // 1. Cập nhật Logo từ mảng footer
                    const logoData = response.footer.find(item => item.settingKey === "setting.general.footer.logo");
                    if (logoData) {
                        $('#main-logo').attr('src', logoData.value);
                    }                  
                }
            },
            error: function (err) {
                console.error("Không thể lấy dữ liệu từ API", err);
            }
        });
    });
</script>
<section class="hero-section d-flex align-items-end">
    <div class="container-fluid px-0">
        <div class="hero-content text-white p-5">
            
            <h1 class="display-3 fw-bold mb-0">@ViewData["Title"]</h1>
            <hr class="border-light opacity-50 mb-4" style="width:90%">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-2">
                    <li class="breadcrumb-item"><a href="/" class="text-white text-decoration-none">Home</a></li>
                    <li class="breadcrumb-item active text-white fw-light" aria-current="page">Hệ thống trung tâm</li>
                </ol>
            </nav>
            
        </div>
    </div>
</section>
<style>
    .hero-section {
    /* Thay đường dẫn ảnh của bạn vào đây */
    background-image: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.6)), url('/uploads/e9a9ef35-6e08-41e8-b8ea-7112e2a130f4_bg1.jpg');
    background-size: cover;
    background-position: center;
    height: 700px; /* Điều chỉnh chiều cao tùy ý */
    position: relative;
    display: flex;
    align-items: flex-end; /* Đẩy nội dung xuống đáy */
}

.hero-content {
    width: 100%;
    background: linear-gradient(transparent, rgba(0,0,0,0.4)); /* Làm tối nhẹ phần chân chữ */
    padding-bottom: 60px !important;
    padding-left: 10% !important;
}

.breadcrumb-item + .breadcrumb-item::before {
    content: ">";
    color: white;
}

.hero-content h1 {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    letter-spacing: -1px;
}

/* Responsive cho mobile */
@@media (max-width: 768px) {
    .hero-section {
        height: 350px;
    }
    .hero-content h1 {
        font-size: 2.5rem;
    }
}
</style>

<section class="centers-section py-5">
    <div class="container">
        <div class="row mb-5 align-items-center">
            <div class="col-md-4">
                <div class="d-flex align-items-center mb-2">
                    <span class="red-line me-2"></span>
                    <span class="text-danger fw-bold text-uppercase small">hệ sinh thái tập đoàn.</span>
                </div>
            </div>
            <div class="col-md-8">
                <h2 class="fw-bold display-6 text-uppercase">Hệ thống 12 trung tâm - <br> Viện nghiên cứu trực thuộc</h2>
            </div>
        </div>

        <div class="row g-4">
            @foreach (var center in Model.Centers)
            {
                <div class="col-md-6 col-lg-4">
                    <div class="center-card h-100">
                        <div class="img-wrapper mb-3">
                            <img src="@center.Image" class="img-fluid rounded-0" alt="@center.Name">
                        </div>

                        <div class="card-body px-0">
                            <h4 class="fw-bold mb-3 center-title">@center.Name</h4>
                            <hr class="w-25 mb-3">
                            <a href="@center.Url" class="text-danger text-decoration-none fw-bold d-flex align-items-center learn-more">
                                <i class="bi bi-arrow-up-right me-2"></i> Tim Hiểu Thêm
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</section>
<style>
    /* Đường kẻ ngang màu đỏ cạnh text header */
    .red-line {
        display: inline-block;
        width: 40px;
        height: 2px;
        background-color: #dc3545;
    }

    /* Định dạng tiêu đề trung tâm */
    .center-title {
        font-size: 1.5rem;
        min-height: 3.6rem; /* Giữ cho các tiêu đề đều nhau nếu chữ dài ngắn khác nhau */
        line-height: 1.2;
    }

    /* Hiệu ứng cho ảnh */
    .img-wrapper {
        overflow: hidden;
        aspect-ratio: 16 / 9; /* Giữ tỉ lệ ảnh chuẩn */
    }

        .img-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

    .center-card:hover img {
        transform: scale(1.05); /* Phóng to nhẹ khi hover */
    }

    /* Nút tìm hiểu thêm */
    .learn-more {
        font-size: 0.9rem;
        transition: gap 0.3s ease;
    }

        .learn-more:hover {
            gap: 10px; /* Tạo hiệu ứng mũi tên dịch chuyển */
        }

    /* Tùy chỉnh font chữ tiêu đề lớn */
    h2 {
        letter-spacing: -1px;
    }
</style>

<section class="collaboration-section py-5">
    <div class="container">
        <div class="row mb-5 align-items-center">
            <div class="col-md-3">
                <div class="d-flex align-items-center mb-2">
                    <span class="red-line me-2"></span>
                    <span class="text-danger fw-bold text-uppercase small">cách thức vận hành.</span>
                </div>
            </div>
            <div class="col-md-9">
                <h2 class="fw-bold display-5 text-uppercase">@GetSt("setting.general.operation.main_title")</h2>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-5 mb-4">
                <div class="sticky-top" style="top: 120px; z-index: 5;">
                    <div class="fixed-image-container shadow-sm">
                        <img id="operation-image" src="@GetSt("setting.general.operation.image.0")"
                             alt="Operation">
                    </div>
                </div>
            </div>

            <div class="col-md-7 ps-md-5">
                <div class="operation-timeline">
                    @{
                        int i = 0;
                        while (Model.Settings.ContainsKey($"setting.general.operation.title.{i}"))
                        {
                            var title = GetSt($"setting.general.operation.title.{i}");
                            var content = GetSt($"setting.general.operation.content.{i}");
                            var imageUrl = GetSt($"setting.general.operation.image.{i}");
                            var displayNum = (i + 1).ToString("D2");

                            <div class="timeline-item d-flex mb-5"
                                 onmouseover="changeOpImage('@imageUrl', this)">
                                <div class="timeline-number-wrapper me-4">
                                    <div class="timeline-number">@displayNum</div>
                                </div>
                                <div class="timeline-content">
                                    <h4 class="fw-bold h5">@title</h4>
                                    <p class="text-muted small">@content</p>
                                </div>
                            </div>
                            i++;
                        }
                    }
                </div>
            </div>
        </div>
    </div>
</section>
<style>
    /* Khung chứa ảnh cố định */
    .fixed-image-container {
        width: 100%;
        /* Bạn có thể chọn tỷ lệ: 1/1 (vuông), 4/3, hoặc 16/9 */
        aspect-ratio: 1 / 1;
        overflow: hidden;
        background-color: #f8f9fa; /* Màu nền chờ nếu ảnh lỗi */
        border-radius: 4px;
    }

        .fixed-image-container img {
            width: 100%;
            height: 100%;
            /* Quan trọng nhất: Giúp ảnh không bị méo, tự cắt tỉa để lấp đầy khung */
            object-fit: cover;
            object-position: center;
            transition: opacity 0.4s ease-in-out;
        }

    /* Tùy chỉnh cho Timeline để mượt hơn */
    .operation-timeline::before {
        content: '';
        position: absolute;
        left: 35px; /* Điều chỉnh để nằm đúng tâm vòng tròn số */
        top: 10px;
        bottom: 50px;
        width: 1px;
        background-color: #dee2e6; /* Màu xám nhạt */
        z-index: -11;
    }

    .timeline-item {
        transition: all 0.3s;
        opacity: 0.5;
    }

        .timeline-item.active {
            opacity: 1;
        }

    .timeline-number {
        width: 50px;
        height: 50px;
     /*    border: 1px solid #dee2e6; */
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: white;
        z-index: -11;
        font-weight: bold;
    }

    .timeline-item.active .timeline-number {
        background-color: #dc3545;
        border-color: #dc3545;
        color: white;
    }
</style>
<script>
    function changeOpImage(imgUrl, element) {
        const mainImg = document.getElementById('operation-image');

        // Chỉ đổi nếu URL khác ảnh hiện tại
        if (mainImg.src !== imgUrl && imgUrl !== "") {
            mainImg.style.opacity = '0.3'; // Mờ dần

            setTimeout(() => {
                mainImg.src = imgUrl;
                mainImg.style.opacity = '1'; // Hiện rõ lại
            }, 200);
        }

        // Active mục đang chọn
        document.querySelectorAll('.timeline-item').forEach(item => {
            item.classList.remove('active');
        });
        element.classList.add('active');
    }

    // Thiết lập mục đầu tiên active khi load trang
    document.addEventListener("DOMContentLoaded", function () {
        const firstItem = document.querySelector('.timeline-item');
        if (firstItem) firstItem.classList.add('active');
    });
</script>
<section class="contact-section py-5 bg-light">
    <div class="container">
        <div class="mb-4">
            <div class="d-flex align-items-center mb-2">
                <span class="red-line-short me-2"></span>
                <span class="text-danger fw-bold text-uppercase small">liên hệ.</span>
            </div>
            <h2 class="fw-bold display-6 text-uppercase">Liên hệ với chúng tôi</h2>
        </div>

        <form class="contact-form mt-5">
            <div class="row g-4">
                <div class="col-md-6">
                    <input type="text" class="form-control-custom" placeholder="Tên *">
                </div>
                <div class="col-md-6">
                    <input type="text" class="form-control-custom" placeholder="Số Điện Thoại *">
                </div>
                <div class="col-md-6">
                    <input type="email" class="form-control-custom" placeholder="Email *">
                </div>
                <div class="col-md-6">
                    <input type="text" class="form-control-custom" placeholder="Tiêu Đề *">
                </div>
                <div class="col-12">
                    <textarea class="form-control-custom" rows="1" placeholder="Nội Dung *"></textarea>
                </div>
            </div>
            <button type="submit" class="btn-submit-circle mt-5">
                <span>Gửi</span>
                <div class="icon-circle"><i class="bi bi-arrow-up-right"></i></div>
            </button>
        </form>
    </div>
</section>
<style>
    /* --- FIX ĐƯỜNG KẺ DỌC --- */
   
    /* --- CỐ ĐỊNH SIZE ẢNH --- */
    .fixed-image-container {
        width: 100%;
        aspect-ratio: 1 / 1; /* Cố định hình vuông */
        overflow: hidden;
        border-radius: 4px;
    }

        .fixed-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

    /* --- CONTACT FORM --- */
    .form-control-custom {
        width: 100%;
        background: transparent;
        border: none;
        border-bottom: 1px solid #dee2e6;
        padding: 15px 0;
        outline: none;
        transition: border-color 0.3s;
    }

        .form-control-custom:focus {
            border-bottom-color: #dc3545;
        }

    .btn-submit-circle {
        display: flex;
        align-items: center;
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 50px;
        padding: 5px 5px 5px 25px;
        font-weight: bold;
        transition: all 0.3s;
    }

        .btn-submit-circle .icon-circle {
            width: 40px;
            height: 40px;
            background: black;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 15px;
        }

    /* --- FOOTER --- */
    .social-btn {
        width: 45px;
        height: 45px;
        background: #1a1a1a;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        border-radius: 4px;
        transition: background 0.3s;
    }

        .social-btn:hover {
            background: #dc3545;
            color: white;
        }
</style>