
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="hero-section d-flex align-items-end">
    <div class="container-fluid px-0">
        <div class="hero-content text-white p-5">

            <h1 class="display-3 fw-bold mb-0">@ViewData["Title"]</h1>
            <hr class="border-light opacity-50 mb-4" style="width:90%">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-2">
                    <li class="breadcrumb-item"><a href="/" class="text-white text-decoration-none">Home</a></li>
                    <li class="breadcrumb-item active text-white fw-light" aria-current="page">Tin tức</li>
                </ol>
            </nav>

        </div>
    </div>
</section>
<style>
    .hero-section {
        /* Thay đường dẫn ảnh của bạn vào đây */
        background-image: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.6)), url('/uploads/fff5733a-2cd6-4e40-b55d-ce3d2fe744f3_540895050_1349604910506179_7192088055664062117_n-1.jpg');
        background-size: cover;
        background-position: center;
        height: 700px; /* Điều chỉnh chiều cao tùy ý */
        position: relative;
        display: flex;
        align-items: flex-end; /* Đẩy nội dung xuống đáy */
    }

    .hero-content {
        width: 100%;
        background: linear-gradient(transparent, rgba(0,0,0,0.4)); /* Làm tối nhẹ phần chân chữ */
        padding-bottom: 60px !important;
        padding-left: 10% !important;
    }

    .breadcrumb-item + .breadcrumb-item::before {
        content: ">";
        color: white;
    }

    .hero-content h1 {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        letter-spacing: -1px;
    }

    /* Responsive cho mobile */
    @@media (max-width: 768px) {
        .hero-section {
            height: 350px;
        }

        .hero-content h1 {
            font-size: 2.5rem;
        }
    }
</style>
<script>
    $(document).ready(function () {
        $.ajax({
            url: '/home/GetHeader',
            type: 'GET',
            success: function (response) {
                if (response.success) {
                    // 1. Cập nhật Logo từ mảng footer
                    const logoData = response.footer.find(item => item.settingKey === "setting.general.footer.logo");
                    if (logoData) {
                        $('#main-logo').attr('src', logoData.value);
                    }
                }
            },
            error: function (err) {
                console.error("Không thể lấy dữ liệu từ API", err);
            }
        });
    });
</script>


<section class="news-list-section py-5">
    <div class="container">
        <div class="row mb-5 justify-content-end">
            <div class="col-md-4">
                <div class="search-box position-relative">
                    <input type="text" id="news-search" class="form-control rounded-pill ps-4 pr-5" placeholder="Tìm kiếm ...">
                    <i class="fa fa-search position-absolute top-50 end-0 translate-middle-y me-3 text-danger"></i>
                </div>
            </div>
        </div>

        <div class="row g-4" id="news-container">
        </div>

        <nav aria-label="Page navigation" class="mt-5">
            <ul class="pagination justify-content-center" id="news-pagination">
            </ul>
        </nav>
    </div>
</section>
<style>
    /* Card Tin tức */
    .news-card {
        border: none;
        transition: transform 0.3s ease;
        height: 100%;
    }

        .news-card .card-img-top {
            height: 220px;
            object-fit: cover;
        }

    .date-badge {
        position: absolute;
        background: white;
        padding: 10px 15px;
        text-align: center;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .date-day {
        font-weight: bold;
        font-size: 1.2rem;
        display: block;
        line-height: 1;
    }

    .date-month {
        font-size: 0.8rem;
        color: #666;
        text-transform: uppercase;
    }

    .news-category {
        font-size: 0.75rem;
        color: #999;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .news-title {
        font-size: 1.25rem;
        font-weight: 700;
        line-height: 1.4;
        margin: 15px 0;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .news-excerpt {
        font-size: 0.9rem;
        color: #555;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .read-more {
        color: #000;
        font-weight: bold;
        text-decoration: underline;
        font-size: 0.85rem;
    }

    /* Tìm kiếm và Phân trang */
    .search-box input {
        border: 1px solid #eee;
        padding: 12px;
    }

    .pagination .page-link {
        border: none;
        color: #333;
        margin: 0 5px;
    }

    .pagination .page-item.active .page-link {
        background-color: transparent;
        color: #f00; /* Màu đỏ làm điểm nhấn */
        font-weight: bold;
        border-bottom: 2px solid #f00;
    }
</style>
<script>
    let currentPage = 1;
    const pageSize = 6;
    let searchQuery = "";
    let timeout = null;

    $(document).ready(function () {
        // Khởi tạo lần đầu
        loadNews(currentPage, searchQuery);

        // Xử lý tìm kiếm với cơ chế Debounce tối ưu
        $('#news-search').on('keyup', function () {
            const val = $(this).val().trim();

            // Chỉ tìm kiếm nếu giá trị thực sự thay đổi
            if (val === searchQuery && val !== "") return;

            clearTimeout(timeout);
            timeout = setTimeout(() => {
                searchQuery = val;
                currentPage = 1; // Reset về trang 1 khi tìm kiếm mới
                loadNews(currentPage, searchQuery);
            }, 500);
        });
    });

    function loadNews(page, search) {
        // Thêm hiệu ứng loading mờ nhẹ nội dung cũ (tùy chọn)
        $('#news-container').css('opacity', '0.5');

        $.ajax({
            url: '/home/GetListNews',
            type: 'GET',
            data: {
                page: page,
                pageSize: pageSize,
                search: search
            },
            success: function (response) {
                $('#news-container').css('opacity', '1');
                if (response.success) {
                    if (response.data.length > 0) {
                        renderNews(response.data);
                        renderPagination(response.totalPages, response.currentPage);
                    } else {
                        // Hiển thị thông báo khi không có kết quả
                        $('#news-container').html('<div class="col-12 text-center py-5"><p class="text-muted">Không tìm thấy bài viết nào phù hợp.</p></div>');
                        $('#news-pagination').html('');
                    }
                }
            },
            error: function (err) {
                $('#news-container').css('opacity', '1');
                console.error("Lỗi khi lấy danh sách tin tức", err);
            }
        });
    }

    function renderNews(items) {
        let html = '';
        items.forEach(item => {
            // Xử lý ngày tháng
            const date = new Date(item.publishedDate);
            const day = date.getDate().toString().padStart(2, '0');
            const month = "TH" + (date.getMonth() + 1);

            html += `
                    <div class="col-md-4 mb-4">
                        <div class="card news-card h-100 shadow-sm border-0">
                            <div class="position-relative">
                                <div class="date-badge">
                                    <span class="date-day">${day}</span>
                                    <span class="date-month">${month}</span>
                                </div>
                                <img src="${item.thumbnail || '/images/default-news.jpg'}" class="card-img-top" alt="${item.title}" style="height: 220px; object-fit: cover;">
                            </div>
                            <div class="card-body pt-4 px-1">
                                <p class="news-category mb-1 text-uppercase small text-muted font-weight-bold">${item.categoryName || 'Tin tức'}</p>
                                <h3 class="news-title h5 font-weight-bold text-dark mb-2" title="${item.title}">${item.title}</h3>
                                <p class="news-excerpt text-muted small mb-3">${item.summary || ''}</p>
                                <a href="/tin-tuc/${item.slug}" class="read-more text-dark font-weight-bold text-decoration-underline">Đọc Thêm</a>
                            </div>
                        </div>
                    </div>
                `;
        });
        $('#news-container').html(html);
    }

    function renderPagination(totalPages, current) {
        if (totalPages <= 1) {
            $('#news-pagination').html('');
            return;
        }

        let html = '';
        // Nút Back
        if (current > 1) {
            html += `<li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="changePage(${current - 1})">&laquo;</a></li>`;
        }

        for (let i = 1; i <= totalPages; i++) {
            html += `
                    <li class="page-item ${i === current ? 'active' : ''}">
                        <a class="page-link" href="javascript:void(0)" onclick="changePage(${i})">${i}</a>
                    </li>
                `;
        }

        // Nút Next
        if (current < totalPages) {
            html += `<li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="changePage(${current + 1})">&raquo;</a></li>`;
        }

        $('#news-pagination').html(html);
    }

    function changePage(page) {
        currentPage = page;
        loadNews(currentPage, searchQuery);
        // Cuộn mượt lên đầu danh sách tin tức
        $('html, body').animate({
            scrollTop: $(".news-list-section").offset().top - 80
        }, 100);
    }
</script>